#!/usr/bin/env bash
# Wrapper script for the audio metadata analysis tool

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
BINARY="$SCRIPT_DIR/scripts/analysis/target/release/analysis"
REPORTS_DIR="$SCRIPT_DIR/reports"

# Check if binary exists
if [ ! -f "$BINARY" ]; then
    echo "Error: Binary not found at $BINARY"
    echo "Please build the project first:"
    echo "  cd scripts/analysis && cargo build --release"
    exit 1
fi

# Create reports directory if it doesn't exist
mkdir -p "$REPORTS_DIR"

# Check if user specified --output-dir
has_output_dir=false
for arg in "$@"; do
    if [[ "$arg" == --output-dir* ]]; then
        has_output_dir=true
        break
    fi
done

# Pass all arguments to the binary, adding --output-dir if not specified
# Output is now a timestamped subdirectory: reports/analysis_YYYYMMDD_HHMMSS/
if [ "$has_output_dir" = false ]; then
    exec "$BINARY" "$@" --output-dir "$REPORTS_DIR"
else
    exec "$BINARY" "$@"
fi
